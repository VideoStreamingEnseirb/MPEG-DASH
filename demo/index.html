<!doctype html>
<html>
    <head>
        <title>Demo DASH</title>
        <style>
            video {
                width: 640px;
                height: 360px;
            }
            #trace {
                width: 500px;
                height:360px;
                font-size: 10px;
            }
            #trace2 {
                width: 500px;
                height:360px;
                font-size: 10px;
            }
        </style>
    </head>
    <body>
        <div>
            <video id="videoPlayer" controls></video>
            <textarea id="trace" placeholder="Trapped events will be displayed here"></textarea>
            <textarea id="trace2" placeholder="Trapped events will be displayed here"></textarea>

        </div>
        <script src="sourcedash/dash.all.debug.js"></script>
        <script>

        var player,firstLoad = true;
        var url = "http://rdmedia.bbc.co.uk/dash/ondemand/testcard/1/client_manifest-events.mpd";

        function init() {
            player = dashjs.MediaPlayer().create();
            player.updateSettings({ 'debug': { 'logLevel': dashjs.Debug.LOG_LEVEL_NONE }});
            player.initialize(document.querySelector("video"), url, true);
            document.getElementById("trace").innerHTML = "";
            document.getElementById("trace2").innerHTML = "";
            setListener();
            console.log(url)
        }

        function showEvent(e)
        {
            //console.log("EVENT RECEIVED: " + e.type);
            //log("EVENT RECEIVED: " + e.type);
            //console.log(e)
            //We double process in order to pretty-print. Only two levels of object properties are exposed.
            for (var index in e)
            {
                    if (index=="request")
                    {
                      // for (var index2 in e[index]){
                      //   log("on a :"+ index2 +" pour "+e[index][index2])
                      // }
                      if(e[index]["mediaType"]=="video")
                      {
                        log("Le FRAGMENT "+e[index]["index"]+" commence à charger et a de type "+e[index]["mediaType"]+", le FRAGMENT commence à " + e[index]["startTime"]+" avec une qualité de "+e[index]["representationId"])
                      }
                      else {
                        log2("Le FRAGMENT "+e[index]["index"]+" commence à charger et a de type "+e[index]["mediaType"]+", le FRAGMENT commence à " + e[index]["startTime"]+" avec une qualité de "+e[index]["representationId"])
                      }
                    }

            }
        }



        function setListener()
        {
            player.on(dashjs.MediaPlayer.events["CAN_PLAY"],showEvent);
            player.on(dashjs.MediaPlayer.events["FRAGMENT_LOADING_STARTED"],showEvent);
            // player.on(dashjs.MediaPlayer.events["FRAGMENT_LOADING_PROGRESS"],showEvent);
            // player.on(dashjs.MediaPlayer.events["FRAGMENT_LOADING_COMPLETED"],showEvent);
            // player.on(dashjs.MediaPlayer.events["BUFFER_LOADED"],showEvent);
            // player.on(dashjs.MediaPlayer.events["BUFFER_LEVEL_STATE_CHANGED"],showEvent);
        }

        function log(msg) {
            // msg = msg.length > 90 ? msg.substring(0, 90) + "..." : msg; // to avoid wrapping with large objects
            var tracePanel = document.getElementById("trace");
            tracePanel.innerHTML += msg + "\n";
            tracePanel.scrollTop = tracePanel.scrollHeight;
        }

        function log2(msg) {
            // msg = msg.length > 90 ? msg.substring(0, 90) + "..." : msg; // to avoid wrapping with large objects
            var tracePanel = document.getElementById("trace2");
            tracePanel.innerHTML += msg + "\n";
            tracePanel.scrollTop = tracePanel.scrollHeight;
        }

        </script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                init();
            });
        </script>
    </body>
</html>
